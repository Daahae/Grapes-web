<!DOCTYPE html>
<html>
  <head>
    <title>Grapes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/Grape.png">
    <!--css-->
    <link rel="stylesheet" href="/init.css">
    <link rel="stylesheet" href="/header.css">
    <link rel="stylesheet" href="/dropdown.css">
    <link rel="stylesheet" href="/section.css">
    <style>
      @import url("mainFull.css") only screen and (min-width:850px);
    </style>
    <!--JS-->
    <script src="http://code.jquery.com/jquery-3.1.0.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.2.1/masonry.pkgd.min.js"></script>
    <script src="jquery.imagesloaded.min.js"></script>
    <script>
    var tmp = <%- JSON.stringify(article_me) %>
<<<<<<< HEAD
=======
    var dataf = <%- JSON.stringify(article_f) %>
>>>>>>> 90b670a11cc7ef868b7eaf021400c7fb0e7b121c
    $(document).ready(function() {
      var $grid = $('#main-section').masonry({

        itemSelector: '.paper'
      });
      var allCnt=tmp.length-1 + dataf.length;
      var meCnt = tmp.length-1;
      var fCnt = dataf.length-1;
      var appendDocument = function() {
           var $paper = $('<div><div class="paper-holder"><a><img src="'+tmp[meCnt].image+'" /></a></div><p class="paper-description">'+tmp[meCnt].owner+'</p><div class="paper-content"><a class="paper-link" href="#"><img src="http://placehold.it/30x30" /></a><p class="paper-text">'+tmp[meCnt].body+'</p></div></div>').addClass('paper');
           $grid.append($paper).masonry('appended', $paper);
      };

      var appendDocument2 = function() {
           var $paper = $('<div><div class="paper-holder"><a><img src="'+dataf[fCnt].image+'" /></a></div><p class="paper-description">'+dataf[fCnt].owner+'</p><div class="paper-content"><a class="paper-link" href="#"><img src="http://placehold.it/30x30" /></a><p class="paper-text">'+dataf[fCnt].body+'</p></div></div>').addClass('paper');
           $grid.append($paper).masonry('appended', $paper);
      };

      appendDocument();
      allCnt-=1;
      meCnt-=1;
      $(window).scroll(function() {
        var scrollHeight = $(window).scrollTop() + $(window).height();
        var documentHeight = $(document).height();
        console.log($(window).scrollTop(), $(window).height(), documentHeight);
        if (parseInt(scrollHeight) >= documentHeight-1) {
          if(fCnt>=0){
            var a = dataf[fCnt].article_id;
          }else{
            var a = -1;
          }
          if(meCnt>=0){
            var b = tmp[meCnt].article_id;
          }else {
            var b = -1;
          }
          console.log('a='+fCnt);
          console.log('b='+meCnt);
          console.log('all='+allCnt);
          if(allCnt>=0)
          {
            allCnt-=1;
            if(a>=0 && b>=0)
            {
              if(a > b){
                appendDocument2();
                fCnt-=1;
              } else if(a < b){
                appendDocument();
                meCnt-=1;
              }
            }else if(a>=0 && b<0) {
              appendDocument2();
              meCnt-=1;
            }else if(a<0 && b>=0){
              appendDocument();
              fCnt-=1;
            }
          }
        }
      });
    });
    </script>
    <script src="dropdown.js"></script>
    <script src="imgLoaded.js"></script>
  </head>
  <body>
    <header>
      <div class="head">
        <a href="/"><img src="/grapebg.png">  Grapes</a>
        <div class="header-menu">
          <ul class="outer-menu">
              <li>
                  <a href="/profile"><%= name%></a>
              </li>
          </ul>
              <ul class="outer-menu">
                  <li>
                      <a href="#"><img src="setting.png" /></a>
                      <ul class="inner-menu">
                          <li><a href="/profile"><%= name%>정보</a></li>
                          <li><a href="/temp">새 글 쓰기</a></li>
                          <li><a href="/logout">로그아웃</a></li>
                      </ul>
                  </li>
              </ul>
          </div>
        </div>
    </header>
    <!-- 본문 영역 -->
    <section id="main-section">
      <div class="paper">
        <div class="paper-holder">
          <a><img width=100%  src="welcome.jpg" /></a>
        </div>
        <p class="paper-description"><%= name%>님 Grapes에 오신걸 환영합니다.</p>
        <div class="paper-content">
          <a class="paper-link" href="#"><img src="http://placehold.it/30x30" /></a>
          <p class="paper-text">당신만의 세계를 보여주세요 </p>
        </div>
      </div>
    </section>
    <div class="goTOP">
      <a class="ho" href="#">
        <p>TOP</p>
      </a>
    </div>
    <footer>
      Grapes ⓣ 2018<br />
      <a href="https://github.com/jong4876/Grapes_Web" target="_blank">https://github.com/jong4876/Grapes_Web</a></footer>
  </body>
</html>
